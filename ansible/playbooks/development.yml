---
- name: Setup development environment
  file:
    path: "{{ item }}"
    state: directory
    owner: okimi
    group: okimi
    mode: '0755'
  loop:
    - /opt/okimi/dev
    - /opt/okimi/dev/logs

- name: Create pre-commit hook template
  copy:
    content: |
      #!/bin/bash
      set -e
      cd {{ okimi_home }}
      bazel build //...
      bazel test //...
    dest: /opt/okimi/.git/hooks/pre-commit
    mode: '0755'
    owner: okimi
    group: okimi

- name: Create developer README
  copy:
    content: |
      # Okimi Development Environment
      
      ## Build
      bazel build //...
      
      ## Test
      bazel test //...
      
      ## Run Auth Service
      bazel run //services/auth:auth_service
      
      ## Run User Service
      bazel run //services/user:user_service
      
      ## Logs
      tail -f /var/log/okimi/*.log
    dest: /opt/okimi/DEV_README.md
    owner: okimi
    group: okimi
